# EmailJS Template Setup for Ticket Escalation

## üìß Create Ticket Escalation Template

After setting up your EmailJS account (see EMAILJS_SETUP.md), you need to create a **second template** specifically for ticket escalation emails.

### Step 1: Create New Template

1. Go to EmailJS Dashboard ‚Üí **Email Templates**
2. Click **"Create New Template"**
3. Name it: **"Ticket Escalation Template"**

### Step 2: Template Configuration

**Subject Line:**
```
[TICKET {{ticket_number}}] {{subject}}
```

**Email Body (HTML):**
```html
<h2 style="color: #2563eb;">Support Ticket Created</h2>

<div style="background: #f3f4f6; padding: 20px; border-radius: 8px; margin: 20px 0;">
  <h3 style="margin-top: 0;">Ticket Information</h3>
  <p><strong>Ticket Number:</strong> {{ticket_number}}</p>
  <p><strong>Priority:</strong> <span style="color: #dc2626;">{{priority}}</span></p>
  <p><strong>Category:</strong> {{category}}</p>
  <p><strong>Company/Service:</strong> {{company}}</p>
  <p><strong>From:</strong> {{from_name}} ({{from_email}})</p>
  <p><strong>Created:</strong> {{created_at}}</p>
</div>

<h3>Main Issue:</h3>
<p style="background: #fef3c7; padding: 15px; border-left: 4px solid #f59e0b;">
  {{subject}}
</p>

<h3>Complete Chat Summary:</h3>
<div style="background: #ffffff; padding: 20px; border: 1px solid #e5e7eb; border-radius: 8px; font-family: monospace; white-space: pre-wrap;">
{{chat_summary}}
</div>

<hr style="margin: 30px 0; border: none; border-top: 1px solid #e5e7eb;">

<p style="color: #6b7280; font-size: 14px;">
  <strong>Note:</strong> This ticket was automatically generated by Smart Escalate AI system.<br>
  The chat summary above contains the complete conversation history between the user and our AI assistant.<br>
  <strong>Reply to this email to respond directly to the user at: {{reply_to}}</strong>
</p>

<div style="margin-top: 30px; padding: 20px; background: #eff6ff; border-radius: 8px;">
  <h4 style="margin-top: 0; color: #1e40af;">Email Details</h4>
  <p style="margin: 0;">
    <strong>To:</strong> {{to_email}}<br>
    <strong>From User:</strong> {{from_email}}<br>
    <strong>Reply-To:</strong> {{reply_to}}
  </p>
</div>
```

### Step 3: Template Variables

Make sure these variables are configured:
- `{{ticket_number}}` - Ticket ID
- `{{subject}}` - Main issue summary
- `{{priority}}` - URGENT, HIGH, MEDIUM, LOW
- `{{category}}` - Issue category
- `{{company}}` - Detected company name
- `{{from_name}}` - User's name
- `{{from_email}}` - User's email address
- `{{reply_to}}` - User's email (for replies)
- `{{chat_summary}}` - Complete conversation history
- `{{created_at}}` - Ticket creation timestamp
- `{{to_email}}` - Recipient email address (company customer care)

### Step 4: Save Template ID

1. After creating the template, click **"Save"**
2. **Copy your Template ID** (looks like: `template_tickets_xyz`)
3. This is the SAME template ID you use in your `.env` file

### Step 5: Test the Template

1. Go to **"Test"** tab in EmailJS template editor
2. Fill in test values for all variables
3. Click **"Send Test Email"**
4. Check your inbox to verify the format looks good

## üè¢ Company Email Mapping

The system automatically sends tickets to these company emails (if detected):

| Company | Email Address | Status |
|---------|--------------|--------|
| Airtel | care@airtel.in | ‚úÖ Active |
| Jio | care@jio.com | ‚úÖ Active |
| Vi/Vodafone Idea | customercare@myvi.in | ‚úÖ Active |
| BSNL | customercare@bsnl.in | ‚úÖ Active |
| Amazon | cs-reply@amazon.in | ‚úÖ Active |
| Flipkart | support@flipkart.com | ‚úÖ Active |
| **Default** | support@smartescalate.ai | üìß Fallback |

> **Note:** If the company is not detected or not in the list, the email goes to your default support email.

## üîß How It Works

1. **User chats with AI** ‚Üí AI provides solutions
2. **After multiple attempts** ‚Üí AI asks: "Would you like to generate a ticket?"
3. **User says yes** ‚Üí AI detects company from conversation
4. **If company not clear** ‚Üí AI asks: "Which company?"
5. **Ticket generated** ‚Üí Email sent automatically to company's customer care
6. **Email contains:**
   - Ticket number and priority
   - Complete chat history
   - Main issue summary
   - Timestamp and category

## üìù Example Email Flow

### Scenario: User having Airtel network issues

**Chat:**
```
User: My Airtel internet is not working
AI: [Provides troubleshooting steps]
User: Still not working
AI: [More solutions]
User: Nothing is working, I'm frustrated
AI: Would you like me to generate a ticket and escalate to Airtel customer care?
User: Yes please
AI: ‚úÖ Ticket TKT-123456 created!
```

**Email sent to:** `care@airtel.in`

**Subject:** `[TICKET TKT-123456] Airtel internet connection issues`

**Body includes:**
- Complete chat between user and AI
- All troubleshooting steps tried
- User's frustration level
- Timestamp of issue

## ‚öôÔ∏è Environment Variables

Make sure your `.env` has:

```bash
# EmailJS Configuration
VITE_EMAILJS_SERVICE_ID=service_abc123
VITE_EMAILJS_TEMPLATE_ID=template_xyz789    # This is for ticket emails!
VITE_EMAILJS_PUBLIC_KEY=AbC123dEf456GhI
```

## üéØ Pro Tips

1. **Use one template for both contact form and tickets** - Just make sure all variables are present
2. **Customize company emails** - Edit `companyEmails` object in `useChatBot.ts`
3. **Test with your own email first** - Before sending to actual companies
4. **Monitor EmailJS dashboard** - Check sent emails and delivery status

---

**Your intelligent ticket escalation system is now ready!** üéâ
